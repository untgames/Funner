#ifndef SYSLIB_PLATFORM_IPHONE_HEADER
#define SYSLIB_PLATFORM_IPHONE_HEADER

#include <syslib/window.h>

namespace syslib
{

namespace iphone
{

struct touch_handle;

typedef touch_handle* touch_t;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Описание одного касания
///////////////////////////////////////////////////////////////////////////////////////////////////
struct TouchDescription
{
  touch_t touch;       //идентификатор касания
  float   x;           //текущее положение пальца относительно окна (0 - у левой границы окна, 1 - у правой)
  float   y;           //текущее положение пальца относительно окна (0 - у верхней границы окна, 1 - у нижней)
  size_t  tap_count;   //количество касаний
};

enum WindowOrientation
{
  WindowOrientation_Portrait           = 1,
  WindowOrientation_PortraitUpsideDown = 1 << 1,
  WindowOrientation_LandscapeLeft      = 1 << 2,
  WindowOrientation_LandscapeRight     = 1 << 3
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Интерфейс слушателя событий окна
///////////////////////////////////////////////////////////////////////////////////////////////////
class IWindowListener
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///События касания
///////////////////////////////////////////////////////////////////////////////////////////////////
    virtual void OnTouchesBegan (size_t touches_count, const TouchDescription* touches) {} //один или несколько пальцев дотронулись до окна
    virtual void OnTouchesMoved (size_t touches_count, const TouchDescription* touches) {} //один или несколько пальцев двигаются в окне
    virtual void OnTouchesEnded (size_t touches_count, const TouchDescription* touches) {} //один или несколько пальцев поднялись с окна

///////////////////////////////////////////////////////////////////////////////////////////////////
///События движения
///////////////////////////////////////////////////////////////////////////////////////////////////
    virtual void OnShakeMotionBegan () {} //пользователь начал жест "тряски" телефона
    virtual void OnShakeMotionEnded () {} //пользователь закончил жест "тряски" телефона

///////////////////////////////////////////////////////////////////////////////////////////////////
///Другие события
///////////////////////////////////////////////////////////////////////////////////////////////////
    virtual void OnOrientationChanged (WindowOrientation new_orientation) {} //изменилась ориентация окна

  protected:
    virtual ~IWindowListener () {}
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Добавление/удаление подписчиков на события окна
///////////////////////////////////////////////////////////////////////////////////////////////////
void attach_window_listener (const Window& window, IWindowListener* listener);
void detach_window_listener (const Window& window, IWindowListener* listener);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Установка/получение multitouch режима для окна
///////////////////////////////////////////////////////////////////////////////////////////////////
void set_multitouch_enabled (const Window& window, bool enabled);
bool get_multitouch_enabled (const Window& window);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Установка/получение разрешенных ориентаций окна
///////////////////////////////////////////////////////////////////////////////////////////////////
void set_allowed_orientations (const Window& window, int orientations_mask);
int  get_allowed_orientations (const Window& window);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Интерфейс слушателя событий приложения
///////////////////////////////////////////////////////////////////////////////////////////////////
class IApplicationListener
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///События
///////////////////////////////////////////////////////////////////////////////////////////////////
    virtual void OnMemoryWarning () {}   //нехватка памяти
    virtual void OnActive        () {}   //приложение стало активным
    virtual void OnInactive      () {}   //приложение стало неактивным

  protected:
    virtual ~IApplicationListener () {}
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Добавление/удаление подписчиков на события приложения
///////////////////////////////////////////////////////////////////////////////////////////////////
void attach_application_listener (IApplicationListener* listener);
void detach_application_listener (IApplicationListener* listener);

}

}

#endif
