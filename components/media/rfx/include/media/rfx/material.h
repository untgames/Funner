#ifndef MEDIALIB_RFX_MATERIAL_HEADER
#define MEDIALIB_RFX_MATERIAL_HEADER

#include <xtl/intrusive_ptr.h>
#include <xtl/functional_fwd>
#include <stl/auto_ptr.h>

namespace media
{

namespace rfx
{

///////////////////////////////////////////////////////////////////////////////////////////////////
///Материал
///////////////////////////////////////////////////////////////////////////////////////////////////
class Material
{  
  public:
    typedef xtl::com_ptr<Material>       Pointer;
    typedef xtl::com_ptr<const Material> ConstPointer;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Копирование
///////////////////////////////////////////////////////////////////////////////////////////////////
    Pointer Clone () const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Имя материала
///////////////////////////////////////////////////////////////////////////////////////////////////
    const char* Name     () const;
    size_t      NameHash () const;
    void        Rename   (const char*);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Установка группы сортировки материала
///////////////////////////////////////////////////////////////////////////////////////////////////
    void SetSortGroup (int group);
    int  SortGroup    () const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Динамическая диспетчеризация
///////////////////////////////////////////////////////////////////////////////////////////////////
    typedef xtl::basic_visitor<void> Visitor;

    void Accept (Visitor&);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Подсчёт ссылок
///////////////////////////////////////////////////////////////////////////////////////////////////
    void AddRef  () const;
    void Release () const;

  protected:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Реализация динамической диспетчеризации
///////////////////////////////////////////////////////////////////////////////////////////////////
    virtual void AcceptCore (Visitor&);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Попытка диспетчеризации
///////////////////////////////////////////////////////////////////////////////////////////////////
    template <class T> static bool TryAccept (T&, Visitor&);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Конструкторы / деструктор
///////////////////////////////////////////////////////////////////////////////////////////////////
            Material  ();
            Material  (const Material&);
    virtual ~Material ();

  private:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Реализация копирования
///////////////////////////////////////////////////////////////////////////////////////////////////
    virtual Material* CloneCore () const;
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Присваивание
///////////////////////////////////////////////////////////////////////////////////////////////////      
    Material& operator = (const Material&); //no impl

  private:
    struct Impl;
    stl::auto_ptr<Impl> impl;
};

#include <media/rfx/detail/material.inl>

}

}

#endif
