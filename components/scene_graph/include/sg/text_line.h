#ifndef SCENE_GRAPH_TEXT_LINE_HEADER
#define SCENE_GRAPH_TEXT_LINE_HEADER

#include <stl/auto_ptr.h>
#include <sg/visual_model.h>

namespace scene_graph
{

///////////////////////////////////////////////////////////////////////////////////////////////////
///Режим выравнивания
///////////////////////////////////////////////////////////////////////////////////////////////////
enum TextLineAlignment
{
  TextLineAlignment_Center = 0,   //по центру
  TextLineAlignment_Left = 1,     //по левому краю
  TextLineAlignment_Right = 2,    //по правому краю
  TextLineAlignment_Top = 1,      //по верхнему краю
  TextLineAlignment_Bottom = 2,   //по нижнему краю
  TextLineAlignment_BaseLine = 3, //по базовой линии

  TextLineAlignment_Num
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///Линия текста
///////////////////////////////////////////////////////////////////////////////////////////////////
class TextLine: public VisualModel
{
  public:
    typedef xtl::com_ptr<TextLine>       Pointer;
    typedef xtl::com_ptr<const TextLine> ConstPointer;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Создание текстовой линии
///////////////////////////////////////////////////////////////////////////////////////////////////
    static Pointer Create ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Цвет текста
///////////////////////////////////////////////////////////////////////////////////////////////////
    void               SetColor (const math::vec4f& color);
    void               SetColor (float red, float green, float blue);
    void               SetColor (float red, float green, float blue, float alpha);
    const math::vec4f& Color    () const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Цвет определенных символов текста
///////////////////////////////////////////////////////////////////////////////////////////////////
    void               SetCharsColorFactors (size_t first, size_t count, const math::vec4f& color);
    const math::vec4f& CharColorFactor      (size_t index) const;
    void               CharsColorFactors    (size_t first, size_t count, math::vec4f* colors) const;
    const math::vec4f& CharColor            (size_t index) const;
    void               CharsColors          (size_t first, size_t count, math::vec4f* colors) const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Установка/получение текста
///////////////////////////////////////////////////////////////////////////////////////////////////
    void                SetTextUtf8   (const char* text_utf8);
    void                SetTextUtf32  (const unsigned int* text_utf32, size_t length);
    const char*         TextUtf8      () const;
    const unsigned int* TextUtf32     () const;
    size_t              TextLength    () const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Хэш текста
///////////////////////////////////////////////////////////////////////////////////////////////////
    size_t TextUtf8Hash  () const;
    size_t TextUtf32Hash () const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Установка/получение имени шрифта
///////////////////////////////////////////////////////////////////////////////////////////////////
    void        SetFont (const char* font_name);
    const char* Font    () const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Установка/получение межбуквенного интервала
///////////////////////////////////////////////////////////////////////////////////////////////////
    void  SetSpacingMultiplier (float spacing_multiplier);
    float SpacingMultiplier    () const;

///////////////////////////////////////////////////////////////////////////////////////////////////
///Выравнивание
///////////////////////////////////////////////////////////////////////////////////////////////////
    void              SetAlignment           (TextLineAlignment horizontal, TextLineAlignment vertical);
    void              SetHorizontalAlignment (TextLineAlignment alignment);
    void              SetVerticalAlignment   (TextLineAlignment alignment);
    TextLineAlignment VerticalAlignment      () const;
    TextLineAlignment HorizontalAlignment    () const;

  protected:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Конструктор / деструктор
///////////////////////////////////////////////////////////////////////////////////////////////////
    TextLine  ();
    ~TextLine ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Динамическая диспетчеризация
///////////////////////////////////////////////////////////////////////////////////////////////////
    void AcceptCore (Visitor&);
    
///////////////////////////////////////////////////////////////////////////////////////////////////
///Связывание свойств узла с методами узла
///////////////////////////////////////////////////////////////////////////////////////////////////
    void BindProperties (common::PropertyBindingMap& bindings);

  private:
    struct Impl;
    stl::auto_ptr<Impl> impl;
};

}

#endif
