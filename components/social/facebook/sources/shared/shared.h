#ifndef SOCIAL_FACEBOOK_SHARED_HEADER
#define SOCIAL_FACEBOOK_SHARED_HEADER

#include <xtl/bind.h>
#include <xtl/common_exceptions.h>
#include <xtl/function.h>

#include <common/component.h>
#include <common/log.h>
#include <common/property_map.h>
#include <common/singleton.h>
#include <common/strlib.h>

#include <social/session.h>

namespace social
{

namespace facebook
{

///////////////////////////////////////////////////////////////////////////////////////////////////
///Facebook сессия
///////////////////////////////////////////////////////////////////////////////////////////////////
class FacebookSessionImpl: public IAchievementManager, public ILeaderboardManager, public IUserManager
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///Конструктор/Деструктор
///////////////////////////////////////////////////////////////////////////////////////////////////
    FacebookSessionImpl  ();
    ~FacebookSessionImpl ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Проверка наличия в PropertyMap неизвестных полей
///////////////////////////////////////////////////////////////////////////////////////////////////
    static void CheckUnknownProperties (const char* source, const common::PropertyMap& properties,
                                        size_t known_properties_count, const char** known_properties_names);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Описание сессии
///////////////////////////////////////////////////////////////////////////////////////////////////
    const char* GetDescription ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Показ стандартных окон
///////////////////////////////////////////////////////////////////////////////////////////////////
    void ShowWindow (const char* window_name, const common::PropertyMap& properties);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Логин
///////////////////////////////////////////////////////////////////////////////////////////////////
    void LogIn          (const LoginCallback& callback, const common::PropertyMap& properties);
    void LogOut         ();
    bool IsUserLoggedIn ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Получение залогиненного пользователя
///////////////////////////////////////////////////////////////////////////////////////////////////
    User& CurrentUser ();

///////////////////////////////////////////////////////////////////////////////////////////////////
///Достижения
///////////////////////////////////////////////////////////////////////////////////////////////////
    void LoadAchievements (const LoadAchievementsCallback& callback, const common::PropertyMap& properties);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Иконка
///////////////////////////////////////////////////////////////////////////////////////////////////
    void LoadAchievementPicture (const Achievement& achievement, const LoadAchievementPictureCallback& callback, const common::PropertyMap& properties);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Публикация
///////////////////////////////////////////////////////////////////////////////////////////////////
    void SendAchievement (const Achievement& achievement, const SendAchievementCallback& callback, const common::PropertyMap& properties);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Таблицы рекордов
///////////////////////////////////////////////////////////////////////////////////////////////////
    void LoadLeaderboards (const LoadLeaderboardsCallback& callback, const common::PropertyMap& properties);
    void LoadLeaderboard  (const char* leaderboard_id, const LoadLeaderboardCallback& callback, const common::PropertyMap& properties);
    void LoadLeaderboard  (const char* leaderboard_id, const char* user_id, const LoadLeaderboardCallback& callback, const common::PropertyMap& properties);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Публикация
///////////////////////////////////////////////////////////////////////////////////////////////////
    void SendScore (const Score& score, const SendScoreCallback& callback, const common::PropertyMap& properties);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Загрузка пользователя по идентификатору
///////////////////////////////////////////////////////////////////////////////////////////////////
    void LoadUser (const char* id, const LoadUserCallback& callback, const common::PropertyMap& properties);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Аватар
///////////////////////////////////////////////////////////////////////////////////////////////////
    void LoadUserPicture (const User& user, const LoadUserPictureCallback& callback, const common::PropertyMap& properties);

///////////////////////////////////////////////////////////////////////////////////////////////////
///Друзья
///////////////////////////////////////////////////////////////////////////////////////////////////
    void LoadFriendsIds (const User& user, const LoadFriendsIdsCallback& callback, const common::PropertyMap& properties);
    void LoadFriends    (const User& user, const LoadFriendsCallback& callback, const common::PropertyMap& properties);

  private:
    FacebookSessionImpl (const FacebookSessionImpl& source);              //no impl
    FacebookSessionImpl& operator = (const FacebookSessionImpl& source);  //no impl

  private:
    common::Log log;
    User        current_user;
};

}

}

#endif
