#ifndef RENDER_MID_LEVEL_RENDERER2D_HEADER
#define RENDER_MID_LEVEL_RENDERER2D_HEADER

#include <render/mid_level/renderer.h>
#include <render/mid_level/common.h>

namespace media
{

//forward declarations
enum PixelFormat;
class Image;

}

namespace render
{

namespace mid_level
{

namespace renderer2d
{

///////////////////////////////////////////////////////////////////////////////////////////////////
///–ежимы смешивани€ цветов при наложении спрайта
///////////////////////////////////////////////////////////////////////////////////////////////////
enum BlendMode
{
  BlendMode_None,        //без смешивани€
  BlendMode_Translucent, //полупрозрачность
  BlendMode_Mask,        //наложение по маске - спрайт €вл€етс€ маской при наложении
  BlendMode_Additive,    //аддитивное наложение

  BlendMode_Num 
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///—прайт
///////////////////////////////////////////////////////////////////////////////////////////////////
struct Sprite
{
  math::vec3f position;   //положение левого центра спрайта
  math::vec2f size;       //размер спрайта
  math::vec4f color;      //цвет спрайта
  math::vec2f tex_offset; //смещение начала спрайта в текстуре [0;1]
  math::vec2f tex_size;   //размер спрайта в текстуре [0;1]
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///—писок спрайтов
///////////////////////////////////////////////////////////////////////////////////////////////////
struct Primitive
{
  ITexture*    texture;       //базова€ текстура
  ISpriteList* sprite_list;   //список спрайтов
  math::mat4f  transform;     //матрица преобразовани€ координат
  BlendMode    blend_mode;    //режим наложени€  
  size_t       first_sprite;  //номер первого спрайта
  size_t       sprites_count; //количество спрайтов
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///ѕакет визуализации 2D-примитивов
///////////////////////////////////////////////////////////////////////////////////////////////////
struct Frame: public mid_level::Frame
{
  math::vec2f size;             //логические размеры кадра
  size_t      primitives_count; //количество примитивов в кадре
  Primitive*  primitives;       //примитивы
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///ƒвумерна€ текстура
///////////////////////////////////////////////////////////////////////////////////////////////////
class ITexture: virtual public IRenderTarget {};

///////////////////////////////////////////////////////////////////////////////////////////////////
///—писок спрайтов
///////////////////////////////////////////////////////////////////////////////////////////////////
class ISpriteList: virtual public IObject
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
/// оличество спрайтов в списке
///////////////////////////////////////////////////////////////////////////////////////////////////
    virtual size_t Size () = 0;

///////////////////////////////////////////////////////////////////////////////////////////////////
///”становка / чтение данных
///////////////////////////////////////////////////////////////////////////////////////////////////
    virtual void SetSprites (size_t first, size_t count, const Sprite* sprites) = 0;
    virtual void SetSprites (size_t first, size_t count, Sprite* sprites) = 0;
};

///////////////////////////////////////////////////////////////////////////////////////////////////
///—истема рендеринга 2D-примитивов
///////////////////////////////////////////////////////////////////////////////////////////////////
class IRenderer: virtual public mid_level::IRenderer
{
  public:
///////////////////////////////////////////////////////////////////////////////////////////////////
///—оздание ресурсов
///////////////////////////////////////////////////////////////////////////////////////////////////
    virtual ITexture*    CreateTexture    (const media::Image& image) = 0;
    virtual ITexture*    CreateTexture    (size_t width, size_t height, media::PixelFormat pixel_format) = 0;
    virtual ISpriteList* CreateSpriteList (size_t sprites_count) = 0;

///////////////////////////////////////////////////////////////////////////////////////////////////
///ƒобавление кадра на отрисовку
///////////////////////////////////////////////////////////////////////////////////////////////////
    virtual void AddFrame (Frame*) = 0;
};

}

}

}

#endif
